!function e(t,n,s){function i(r,a){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n?n:e)},c,c.exports,e,t,n,s)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)i(s[r]);return i}({1:[function(e,t,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,n,s,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(r(n))for(o=Array.prototype.slice.call(arguments,1),u=n.slice(),s=u.length,l=0;s>l;l++)u[l].apply(this,o);return!0},s.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},s.prototype.removeListener=function(e,t){var n,s,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,s=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=a;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var i=e("./map.js"),o=s(i),r=e("./overlay.js"),a=s(r),l=document.getElementsByClassName("map")[0],u={center:{lat:52.3942358,lng:-2.2905},zoom:7},c=new o["default"]({el:l,defaults:u,input:document.getElementById("input"),countryCode:"GB"}),h=new a["default"](c);window.App=h},{"./map.js":3,"./overlay.js":4}],3:[function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),l=e("events"),u=function(e){function t(){s(this,t);var e=i(this,Object.getPrototypeOf(t).call(this)),n=Date.now();if(e.body=document.body,e.settings=arguments[0],e.markers={},e.previousSettings={bounds:{north:null,east:null,south:null,west:null},lat:null,lng:null},"object"===("undefined"==typeof google?"undefined":r(google))&&google.hasOwnProperty("maps"))e.initMap();else{var o=document.createElement("SCRIPT");o.src="https://maps.googleapis.com/maps/api/js?libraries=places&callback=Map"+n,o.defer=!0,o.async=!0,e.body.appendChild(o),window["Map"+n]=e.initMap.bind(e)}return e}return o(t,e),a(t,[{key:"initMap",value:function(){var e=Object.assign(this.settings.defaults,{streetViewControl:!1});this.map=new google.maps.Map(this.settings.el,e),this.geocoder=new google.maps.Geocoder,this.autocomplete=new google.maps.places.Autocomplete(this.settings.input,{types:["(cities)"],componentRestrictions:{country:this.settings.countryCode}}),this.autocomplete.addListener("place_changed",this.placeChanged.bind(this)),this.emit("loaded")}},{key:"placeChanged",value:function(){var e=this.autocomplete.getPlace();e.hasOwnProperty("geometry")?this.emit("gotPlace",e):this.emit("error",{code:1,msg:"No geometry property on place object",data:e})}},{key:"updateMap",value:function(e){var t={north:e.geometry.viewport.R.j,east:e.geometry.viewport.j.R,south:e.geometry.viewport.R.R,west:e.geometry.viewport.j.j},n=e.geometry.location.lat(),s=e.geometry.location.lng();e.bounds=t,this.previousSettings.lat!==n&&this.previousSettings.lng!==s&&(this.previousSettings.lat=n,this.previousSettings.lng=s,this.map.setOptions({center:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},zoom:12})),this.hasOwnProperty("rectangle")?(north!==this.previousSettings.bounds.north,east!==this.previousSettings.bounds.east,south!==this.previousSettings.bounds.south,west!==this.previousSettings.bounds.west&&(this.previousSettings.bounds={north:north,east:east,south:south,west:west},this.rectangle.setBounds(t))):this.rectangle=new google.maps.Rectangle({bounds:t,map:this.map,fillColor:"#000000",fillOpacity:0,strokeColor:"#e64c4c",strokeOpacity:.8,strokeWeight:2}),this.emit("updated",e)}},{key:"addMarkers",value:function(e){var t=e.key,n=e.data;if("all"===t)throw"can't use the key all";if(this.markers.hasOwnProperty(t))throw"already a property with the key "+t;this.markers[t]=[],n.forEach(function(e){var n=e.lat,s=e.lng,i=new google.maps.Marker({position:{lat:n,lng:s},map:this.map});this.markers[t].push(i)}.bind(this))}},{key:"removeMarkers",value:function(e){function t(e){e.forEach(function(e){e.setMap(null)})}if("all"===e){for(var n in this.markers)t(this.markers[n]);this.markers=[]}else t(this.markers[e]),delete this.markers[e]}}]),t}(l.EventEmitter);n["default"]=u},{events:1}],4:[function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a=e("events"),l=e("./police-api.js"),u=function(e){function t(e){s(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.map=e,n.mapData={place:null,poly:null},n.el={$place:null,$overlay:null,$submit:null,$year:null,$month:null,$policeData:null},n.eventFns={click:[],change:[]},n.possibleDates=null,n.loading=!1,n.maxDate=null,n.policeData={requestEnd:null,requestStart:null,crimes:null},n.overlay={isOpen:!1,requestStart:null,requestEnd:null,isClosing:!1},(0,l.lastUpdated)(function(e,t){if(!e){var n=t.date.split("-").slice(0,2);n=new Date(n[0],n[1]-1),this.maxDate=n.getTime(),this.init()}}.bind(n)),n}return o(t,e),r(t,[{key:"generateDates",value:function(){for(var e={},t=new Date(2012,0),n=void 0,s=void 0,i=void 0,o=void 0,r=this.maxDate;t.getTime()<r;){var a=t.getFullYear(),l=t.getMonth()+1;e.hasOwnProperty(a)||(e[a]=[]),e[a].push(l),t.setMonth(t.getMonth()+1)}n=Object.keys(e),s=n[n.length-1],i=e[s],i=i[i.length-1],this.el.$year.innerHTML=n.map(function(e){return'<option value="'+e+'">'+e+"</option>"}).join(""),o=this.el.$year.getElementsByTagName("option"),this.el.$year.value=o[o.length-1].value,this.possibleDates=e,this.setMonths(s,i),this.currentDate=s+"-"+i}},{key:"setMonths",value:function(e,t){var n=this.possibleDates[e];if(this.el.$month.innerHTML=n.map(function(e){return'<option value="'+e+'">'+e+"</option>"}).join(""),t){var s=t;n[t-1]||(s=1);this.el.$month.getElementsByTagName("option");this.el.$month.value=s}}},{key:"gotPlace",value:function(e){this.mapData.place=e,this.mapData.poly=this.createPoly(e.geometry.viewport.R.j,e.geometry.viewport.j.R,e.geometry.viewport.R.R,e.geometry.viewport.j.j)}},{key:"mapError",value:function(){console.log(arguments)}},{key:"policeDataFn",value:function(e,t){function n(e){var t=this;this.el.$policeData.innerHTML=e,setTimeout(function(){t.el.$policeData.classList.add("map-overlay__police-data--show"),t.overlay.isOpen=!0},0)}var s=this;e||t.hasOwnProperty("status")||!function(){var e={},i="",o=void 0;s.policeData.requestEnd=Date.now(),t.forEach(function(t){var n=t.category.replace(/-/g," ").split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substr(1)}).join(" ");e.hasOwnProperty(n)||(e[n]=[]),e[n].push(t)});for(var r in e)i+="<div class='map-overlay__police-data__section' data-category=\""+r+'">'+e[r].length+" x "+r+"</div>";i+='<p class="map-overlay__police-data__total">Total: '+t.length+"</p>",o=s.policeData.requestEnd-s.policeData.requestStart,s.policeData.crimes=e,s.overlay.isClosing===!1?n.call(s,[i]):s.once("OVERLAY-CLOSED",function(){n.call(this,[i])})}()}},{key:"createPoly",value:function(e,t,n,s){var i=e+","+t+":"+n+","+t+":"+n+","+s+":"+e+","+s;return i}},{key:"submitClick",value:function(){if(""===this.el.$place.value.trim())console.log("PLEASE SELECT A PLACE");else{var e=this.el.$year.value+"-"+this.el.$month.value;this.el.$submit.classList.add("map-overlay__button--loading"),this.map.updateMap(this.mapData.place),this.loading=!0,this.policeData.requestStart=Date.now(),this.overlay.isOpen&&this.closeOverlay(),(0,l.getData)({poly:this.mapData.poly,date:e,callback:this.policeDataFn.bind(this)})}}},{key:"closeOverlay",value:function(){var e=this;this.map.removeMarkers("all"),this.overlay.isClosing=!0,this.el.$policeData.classList.add("map-overlay__police-data--closing"),this.el.$policeData.style.transitionDelay="0.1s",setTimeout(function(){e.el.$policeData.classList.remove("map-overlay__police-data--show")},0),setTimeout(function(){e.el.$policeData.style.transitionDelay=null,e.el.$policeData.classList.remove("map-overlay__police-data--closing"),setTimeout(function(){e.overlay.isOpen=!1,e.overlay.isClosing=!1,e.emit("OVERLAY-CLOSED")},400)},100)}},{key:"dataClick",value:function(e){var t=e.getAttribute("data-category");if(e.classList.contains("map-overlay__police-data__section--active"))e.classList.remove("map-overlay__police-data__section--active"),this.map.removeMarkers(t);else{var n=this.policeData.crimes[t].map(function(e){return{lat:parseFloat(e.location.latitude),lng:parseFloat(e.location.longitude)}});e.classList.add("map-overlay__police-data__section--active"),this.map.addMarkers({key:t,data:n})}}},{key:"yearChange",value:function(){var e=this.el.$year.value,t=this.el.$month.value;this.setMonths(e,t)}},{key:"eventHandler",value:function(e,t){var n=t.target,s=n,i=this.eventFns[t.type],o=this;Array.isArray(i)&&i.forEach(function(t){var i=!1;for(n=s;!i&&!n.isSameNode(e);)"string"==typeof t.el?n.classList.contains(t.el)?i=!0:n=n.parentElement:n.isSameNode(t.el)?i=!0:n=n.parentElement;i&&t.fn.call(o,n)})}},{key:"init",value:function(){this.el.$overlay=document.getElementsByClassName("map-overlay")[0],this.el.$submit=this.el.$overlay.getElementsByClassName("map-overlay__button")[0],this.el.$place=this.el.$overlay.getElementsByClassName("map-overlay__input")[0],this.el.$year=this.el.$overlay.getElementsByClassName("map-overlay__year-select")[0],this.el.$month=this.el.$overlay.getElementsByClassName("map-overlay__month-select")[0],this.el.$policeData=this.el.$overlay.getElementsByClassName("map-overlay__police-data")[0],this.generateDates(),this.map.on("gotPlace",this.gotPlace.bind(this)).on("error",this.mapError.bind(this)),this.el.$overlay.addEventListener("click",this.eventHandler.bind(this,this.el.$overlay)),this.el.$overlay.addEventListener("change",this.eventHandler.bind(this,this.el.$overlay)),this.eventFns.change.push({el:this.el.$year,fn:this.yearChange}),this.eventFns.click.push({el:this.el.$submit,fn:this.submitClick}),this.eventFns.click.push({el:"map-overlay__police-data__section",fn:this.dataClick}),this.el.$overlay.classList.add("map-overlay--show")}}]),t}(a.EventEmitter);n["default"]=u},{"./police-api.js":5,events:1}],5:[function(e,t,n){"use strict";function s(e){var t=e.date,n=e.poly,s=e.callback;fetch(o+("?poly="+n+"&date="+t)).then(function(e){return 200===e.status?e.json():{status:e.status,statusText:e.statusText}}).then(function(e){s(null,e)})["catch"](function(e){s(e)})}function i(e){fetch("https://data.police.uk/api/crime-last-updated").then(function(e){return e.json()}).then(function(t){e(null,t)})["catch"](function(t){e(t)})}Object.defineProperty(n,"__esModule",{value:!0}),n.getData=s,n.lastUpdated=i;var o="https://data.police.uk/api/crimes-street/all-crime"},{}]},{},[2]);
//# sourceMappingURL=main.min.js.map
