!function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,i,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,l=0;r>l;l++)u[l].apply(this,i);return!0},r.prototype.addListener=function(e,t){var n;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,i,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,r=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=i;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function i(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function s(e){var t=new FileReader;return t.readAsArrayBuffer(e),i(t)}function a(e){var t=new FileReader;return t.readAsText(e),i(t)}function l(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(d.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(d.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!d.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type&&this.headers.set("content-type",this._bodyBlob.type))},d.blob?(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(s)},this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=o(this);return e?e:Promise.resolve(this._bodyText)},d.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(e){var t=e.toUpperCase();return y.indexOf(t)>-1?t:e}function c(e,t){t=t||{};var n=t.body;if(c.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new r(t.headers)),this.method=u(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function h(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function p(e){var t=new r,n=e.getAllResponseHeaders().trim().split("\n");return n.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function f(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof r?t.headers:new r(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){r.prototype.append=function(e,r){e=t(e),r=n(r);var o=this.map[e];o||(o=[],this.map[e]=o),o.push(r)},r.prototype["delete"]=function(e){delete this.map[t(e)]},r.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},r.prototype.getAll=function(e){return this.map[t(e)]||[]},r.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},r.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},r.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)};var d={blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e},y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this)},l.call(c.prototype),l.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var e=new f(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];f.redirect=function(e,t){if(-1===m.indexOf(t))throw new RangeError("Invalid status code");return new f(null,{status:t,headers:{location:e}})},e.Headers=r,e.Request=c,e.Response=f,e.fetch=function(e,t){return new Promise(function(n,r){function o(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var i;i=c.prototype.isPrototypeOf(e)&&!t?e:new c(e,t);var s=new XMLHttpRequest;s.onload=function(){var e=1223===s.status?204:s.status;if(100>e||e>599)return void r(new TypeError("Network request failed"));var t={status:e,statusText:s.statusText,headers:p(s),url:o()},i="response"in s?s.response:s.responseText;n(new f(i,t))},s.onerror=function(){r(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&d.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],3:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}var i=e("./map.js"),s=o(i),a=e("whatwg-fetch"),l=(r(a),e("./overlay.js")),u=o(l),c=document.getElementsByClassName("map")[0],h={center:{lat:52.3942358,lng:-2.2905},zoom:7},p=new s["default"]({el:c,defaults:h,input:document.getElementById("input"),countryCode:"GB"}),f=new u["default"];p.on("updated",f.locationChanged.bind(f)),p.on("error",function(){console.log(arguments)}),f.on("addMarkers",p.addMarkers.bind(p)),f.on("removeMarkers",p.removeMarkers.bind(p))},{"./map.js":4,"./overlay.js":5,"whatwg-fetch":2}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this)),n=Date.now();if(e.body=document.body,e.settings=arguments[0],e.markers={},"object"===("undefined"==typeof google?"undefined":s(google))&&google.hasOwnProperty("maps"))e.initMap();else{var i=document.createElement("SCRIPT");i.src="https://maps.googleapis.com/maps/api/js?libraries=places&callback=Map"+n,i.defer=!0,i.async=!0,e.body.appendChild(i),window["Map"+n]=e.initMap.bind(e)}return e}return i(t,e),a(t,[{key:"initMap",value:function(){var e=Object.assign(this.settings.defaults,{streetViewControl:!1,scrollwheel:!1});this.map=new google.maps.Map(this.settings.el,e),this.geocoder=new google.maps.Geocoder,this.autocomplete=new google.maps.places.Autocomplete(this.settings.input,{types:["(cities)"],componentRestrictions:{country:this.settings.countryCode}}),this.autocomplete.addListener("place_changed",this.placeChanged.bind(this)),this.emit("loaded")}},{key:"placeChanged",value:function(){var e=this.autocomplete.getPlace();e.hasOwnProperty("geometry")?this.updateMap(e):this.emit("error",{code:1,msg:"No geometry property on place object",data:e})}},{key:"updateMap",value:function(e){var t={north:e.geometry.viewport.R.j,east:e.geometry.viewport.j.R,south:e.geometry.viewport.R.R,west:e.geometry.viewport.j.j};e.bounds=t,this.map.setOptions({center:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},zoom:12}),this.hasOwnProperty("rectangle")?this.rectangle.setBounds(t):this.rectangle=new google.maps.Rectangle({bounds:t,map:this.map,fillColor:"#000000",fillOpacity:0,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2}),this.emit("updated",e)}},{key:"addMarkers",value:function(e){var t=e.key,n=e.data;if("all"===t)throw"can't use the key all";if(this.markers.hasOwnProperty(t))throw"already a property with the key "+t;this.markers[t]=[],n.forEach(function(e){var n=e.lat,r=e.lng,o=new google.maps.Marker({position:{lat:n,lng:r},map:this.map});this.markers[t].push(o)}.bind(this))}},{key:"removeMarkers",value:function(e){function t(e){e.forEach(function(e){e.setMap(null)})}if("all"===e){for(var n in this.markers)t(this.markers[n]);this.markers=[]}else t(this.markers[e]),delete this.markers[e]}}]),t}(l.EventEmitter);n["default"]=u},{events:1}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("events"),l=e("./police-api.js"),u=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e.body=document.body,e.$overlay=document.getElementsByClassName("map-overlay")[0],e.$policeData=e.$overlay.getElementsByClassName("map-overlay__police-data")[0],e.$yearSelect=e.$overlay.getElementsByClassName("map-overlay__year-select")[0],e.$monthSelect=e.$overlay.getElementsByClassName("map-overlay__month-select")[0],e.$toggle=document.getElementsByClassName("map-overlay-toggle")[0],e.policeData={showingData:!1,requestStart:null,requestEnd:null,crimes:null},e.$toggle.addEventListener("click",e.toggleClick.bind(e)),e.$overlay.addEventListener("click",e.overlayClick.bind(e)),e.$overlay.addEventListener("change",e.overlayChange.bind(e)),(0,l.lastUpdated)(function(e,t){if(!e){var n=t.date.split("-"),r=parseInt(n[0]),o=parseInt(n[1])-1,i=new Date(r,o);i.setMonth(i.getMonth()-1),this.maxDate={year:i.getFullYear(),month:i.getMonth()},this.$overlay.classList.add("map-overlay--loaded"),this.generateDates()}}.bind(e)),e}return i(t,e),s(t,[{key:"generateDates",value:function(){for(var e={},t=new Date(2012,0),n=void 0,r=void 0,o=void 0,i=void 0,s=new Date(this.maxDate.year,this.maxDate.month).getTime();t.getTime()<s;){var a=t.getFullYear(),l=t.getMonth()+1;e.hasOwnProperty(a)||(e[a]=[]),e[a].push(l),t.setMonth(t.getMonth()+1)}n=Object.keys(e),r=n[n.length-1],o=e[r],o=o[o.length-1],this.$yearSelect.innerHTML=n.map(function(e){return'<option value="'+e+'">'+e+"</option>"}).join(""),i=this.$yearSelect.getElementsByTagName("option"),this.$yearSelect.value=i[i.length-1].value,this.possibleDates=e,this.setMonths(r,o)}},{key:"setMonths",value:function(e,t){var n=this.possibleDates[e];if(this.$monthSelect.innerHTML=n.map(function(e){return'<option value="'+e+'">'+e+"</option>"}).join(""),t){var r=t;n[t-1]||(r=1);this.$monthSelect.getElementsByTagName("option");this.$monthSelect.value=r}}},{key:"createPoly",value:function(e){var t=e.north,n=e.east,r=e.south,o=e.west,i=t+","+n+":"+r+","+n+":"+r+","+o+":"+t+","+o;return i}},{key:"policeDataCallback",value:function(e,t){function n(e){var t=this;this.policeData.showingData=!0,this.$policeData.innerHTML=e,setTimeout(function(){t.$policeData.classList.add("map-overlay__police-data--show")},50)}var r=this;e?this.emit("error",e):!function(){var e={},o="",i=void 0;r.policeData.requestEnd=Date.now(),t.forEach(function(t){var n=t.category.replace(/-/g," ").split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substr(1)}).join(" ");e.hasOwnProperty(n)||(e[n]=[]),e[n].push(t)});for(var s in e)o+="<div class='map-overlay__police-data__section' data-category=\""+s+'">'+e[s].length+" x "+s+"</div>";o+="<p>Total: "+t.length+"</p>",i=r.policeData.requestEnd-r.policeData.requestStart,r.policeData.crimes=e,1e3>i?setTimeout(function(){n.call(r,[o])},1e3-i):n.call(r,[o])}()}},{key:"locationChanged",value:function(e){var t=this,n=this.createPoly(e.bounds);this.policeData.requestStart=Date.now(),this.policeData.showingData===!0&&(this.$policeData.style.transitionDelay="0.3s",setTimeout(function(){t.$policeData.classList.remove("map-overlay__police-data--show"),setTimeout(function(){t.$policeData.style.transitionDelay=null},350)},50)),(0,l.getData)({poly:n,date:"2015-12",callback:this.policeDataCallback.bind(this)})}},{key:"overlayClick",value:function(e){var t=e.target;if(t.classList.contains("map-overlay__police-data__section")){var n=t.getAttribute("data-category");if(t.classList.contains("map-overlay__police-data__section--active"))t.classList.remove("map-overlay__police-data__section--active"),this.emit("removeMarkers",n);else{var r=this.policeData.crimes[n].map(function(e){return{lat:parseFloat(e.location.latitude),lng:parseFloat(e.location.longitude)}});t.classList.add("map-overlay__police-data__section--active"),this.emit("addMarkers",{key:n,data:r})}}}},{key:"overlayChange",value:function(e){var t=e.target,n=t.classList.contains("map-overlay__year-select");t.classList.contains("map-overlay__month-select");n&&this.setMonths(t.value,this.$monthSelect.value)}},{key:"toggleClick",value:function(e){this.$overlay.classList.toggle("map-overlay--show"),e.target.classList.toggle("map-overlay-toggle--open")}}]),t}(a.EventEmitter);n["default"]=u},{"./police-api.js":6,events:1}],6:[function(e,t,n){"use strict";function r(e){var t=e.date,n=e.poly,r=e.callback;fetch(i+("?poly="+n+"&date="+t)).then(function(e){return e.json()}).then(function(e){r(null,e)})["catch"](function(e){r(e)})}function o(e){fetch("https://data.police.uk/api/crime-last-updated").then(function(e){return e.json()}).then(function(t){e(null,t)})["catch"](function(t){e(t)})}Object.defineProperty(n,"__esModule",{value:!0}),n.getData=r,n.lastUpdated=o;var i="https://data.police.uk/api/crimes-street/all-crime"},{}]},{},[3]);
//# sourceMappingURL=main.min.js.map
